function setCombPrototypeInit(t){$("section[data-loopindex]").hide(),$("section[data-loopindex]").eq(t-1).show().find("li.protoLayer").each(function(){var t=$(this).find(".tab").removeClass("tab-sel").eq(0).addClass("tab-sel").attr("data-id");$(this).attr("data-select",t)})}function addnumber(){$("#num").val(parseInt($("#num").val())+1),$(".textWrap .tt span").html($("#num").val()),refresh_price()}function minnumber(){$("#num").val()>1&&($("#num").val(parseInt($("#num").val())-1),$(".textWrap .tt span").html($("#num").val()),refresh_price())}function inputnumber(){var t=parseInt($("#num").val());isNaN(t)||t<1?($("#num").val("1"),$(".textWrap .tt span").html(1),refresh_price()):t>1&&($("#num").val(t),$(".textWrap .tt span").html(t)),refresh_price()}function refresh_price(){$.ajax({url:"/checkout.php?",type:"post",data:$("#comb input[checked=checked], #act, input[name='num']"),dataType:"json",success:function(t){t.ret?($("#price").html(t.total),$("input[name='price']").val(t.total)):alert(t.msg)},error:function(t,a,e){}})}function postcheckGuige(){var t="/checkout.php?";t=(t=t+"count="+(parseInt($("input#num").val())||1))+"&combo_id="+$("#comb .tab-sel").find("input").val()+"&product_id="+$('input[name="product_id"]').val();var a=[];if($("section[data-loopIndex]:visible .u-format.count_atrr").length>0){if($("section[data-loopIndex]:visible .u-format.count_atrr").each(function(){var t=$(this).attr("data-group"),e=$(this).attr("data-select");parseInt(e)>0&&a.push(t+"-"+e)}),0==a.length)return alert("请选择属性"),!1;t=t+"&proto="+a.join("|")}return window.location.href=t,!1}function cur_chosen(){for(var t="",a=parseInt($(".tab-sel").eq(0).attr("data-loopindex"))-1,e=$("section[data-loopindex]").eq(a),r=0;r<e.length;r++){var n=e.eq(r).find(".tab-sel");if(n.length){for(var i=0;i<n.length-1;i++)t+="<span>"+n.eq(i).html()+"</span>,";t+="<span>"+n.eq(i).html()+"</span>;"}else $("[chosen]").parents(".sku").remove()}$("[chosen]").html(t)}require(["jquery"],function(t){t("#comb .tab").eq(0).addClass("tab-sel").find("input").attr("checked","true"),t("#comb").attr("data-price",t("#comb .tab-sel").attr("data-price")),t("[currentprice]").html(t("#comb .tab-sel").attr("data-price")),setCombPrototypeInit(1),t("#comb .tab").click(function(a){a.preventDefault(),t(this).addClass("tab-sel").siblings().removeClass("tab-sel"),t(this).find("input").attr("checked","true"),t(this).siblings().find("input").attr("checked",!1),t("#comb").attr("data-price",t(this).attr("data-price")),t("[currentprice]").html(t(this).attr("data-price")),setCombPrototypeInit(t(this).attr("data-loopIndex")),refresh_price(),cur_chosen()}),t(".u-format.count_atrr").each(function(){var a=t(this).find(".tab").attr("data-id");t(this).attr("data-select",a)}),t(".u-format.count_atrr").on("click",".tab",function(){var a=t(this),e=a.attr("data-id");a.addClass("tab-sel").siblings().removeClass("tab-sel"),a.parents(".u-format.count_atrr").attr("data-select",e);var r=a.attr("data-img");r&&t("#attrimg").attr("src",r),cur_chosen()}),cur_chosen()}),$(".buy_now").on("click",function(){if($("#add").hasClass("ok"))postcheckGuige();else{var t=$(window).height();$("#page-order").show(),$(window).scrollTop(0),$("#page-order").css("top",t),$("#page-order").animate({top:0},500),$("#page-index").delay(400).hide(0),$("#add").addClass("ok")}});